<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¥Š åµæ¶åŒ…èµ¢ - è®©ä½ åœ¨ä»»ä½•äº‰è®ºä¸­éƒ½æ— å¾€ä¸èƒœ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'wechat-primary': '#07C160',
            'wechat-secondary': '#1AAD19',
            'wechat-light': '#F7F7F7',
            'wechat-dark': '#181818',
            'wechat-gray': '#ABABAB',
          }
        }
      }
    }
  </script>
  <style>
    /* è‡ªå®šç¾©æ»‘å‹•æ¢æ¨£å¼ */
    .slider::-webkit-slider-thumb {
      appearance: none;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: #07C160;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .slider::-moz-range-thumb {
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: #07C160;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* åŠ è¼‰å‹•ç•« */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .animate-spin {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-wechat-light to-gray-50">
  <div class="min-h-screen px-4 py-8">
    <div class="max-w-md mx-auto">
      <!-- é é¢æ¨™é¡Œ -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">
          ğŸ¥Š åµæ¶åŒ…èµ¢
        </h1>
        <p class="text-gray-600 text-sm">
          è®©ä½ åœ¨ä»»ä½•äº‰è®ºä¸­éƒ½æ— å¾€ä¸èƒœï¼
        </p>
      </div>

      <!-- ä¸»è¦è¼¸å…¥å€åŸŸ -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <!-- å°æ–¹çš„è©±è¼¸å…¥ -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            å¯¹æ–¹è¯´äº†ä»€ä¹ˆï¼Ÿ
          </label>
          <textarea
            id="opponentText"
            placeholder="åœ¨è¿™é‡Œè¾“å…¥å¯¹æ–¹çš„è¯..."
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wechat-primary focus:border-transparent resize-none"
            rows="4"
            maxlength="200"
          ></textarea>
          <div class="text-right text-xs text-gray-400 mt-1">
            <span id="charCount">0</span>/200
          </div>
        </div>

        <!-- èªæ°£å¼·åº¦æ»‘å‹•æ¢ -->
        <div class="mb-6">
          <div class="w-full">
            <div class="flex justify-between items-center mb-4">
              <label class="text-sm font-medium text-gray-700">
                è¯­æ°”å¼ºçƒˆç¨‹åº¦
              </label>
              <span class="text-lg font-bold text-wechat-primary" id="intensityValue">
                5/10
              </span>
            </div>
            
            <div class="relative">
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                id="intensitySlider"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
              />
            </div>
            
            <div class="mt-3 text-center">
              <span class="text-sm font-medium text-gray-600" id="intensityLabel">
                çŠ€åˆ©
              </span>
            </div>
            
            <div class="flex justify-between mt-2 text-xs text-gray-400">
              <span>1</span>
              <span>5</span>
              <span>10</span>
            </div>
          </div>
        </div>

        <!-- éŒ¯èª¤ä¿¡æ¯ -->
        <div id="errorMessage" class="mb-4 p-3 bg-red-100 border border-red-300 rounded-lg text-red-700 text-sm hidden">
        </div>

        <!-- æŒ‰éˆ•å€åŸŸ -->
        <div class="flex space-x-3">
          <button
            id="submitBtn"
            class="flex-1 bg-wechat-primary hover:bg-wechat-secondary disabled:bg-gray-300 text-white font-bold py-3 px-6 rounded-lg transition-colors"
          >
            ğŸ”¥ å¼€å§‹åµæ¶
          </button>
          <button
            id="clearBtn"
            class="px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"
          >
            æ¸…ç©º
          </button>
        </div>
      </div>

      <!-- å›æ‡‰é¡¯ç¤ºå€åŸŸ -->
      <div id="responseArea" class="bg-white rounded-lg shadow-lg p-6 hidden">
        <div id="loadingArea" class="text-center text-wechat-gray hidden">
          <div class="inline-flex items-center">
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-wechat-primary mr-2"></div>
            æ­£åœ¨ç”Ÿæˆç‰›é€¼çš„å›åº”...
          </div>
        </div>
        
        <div id="responsesContainer">
          <h3 class="text-lg font-bold text-center text-gray-800 mb-6">
            ğŸ”¥ ä¸ºä½ é‡èº«å®šåšçš„å›æ€¼ ğŸ”¥
          </h3>
          <div id="responsesList"></div>
          <div class="text-center mt-6">
            <button
              id="copyAllBtn"
              class="bg-wechat-primary hover:bg-wechat-secondary text-white font-bold py-3 px-6 rounded-lg transition-colors"
            >
              ğŸ“‹ å¤åˆ¶å…¨éƒ¨å›åº”
            </button>
          </div>
        </div>
      </div>

      <!-- é è…³ -->
      <div class="text-center mt-8 text-xs text-gray-400">
        <p>âš¡ ç”± AI é©±åŠ¨ï¼Œè®©ä½ åœ¨äº‰è®ºä¸­æ°¸è¿œå ä¸Šé£</p>
        <p class="mt-1">ä½¿ç”¨æ—¶è¯·ç†æ€§ï¼Œç»´æŒè‰¯å¥½æ²Ÿé€šæ°›å›´ ğŸ’ª</p>
      </div>
    </div>
  </div>

  <script>

    const intensityLabels = [
      'æ¸©å’Œ', 'ç¨ä¸¥è‚ƒ', 'ç›´æ¥', 'ä¸¥å‰', 'çŠ€åˆ©', 
      'å¼ºçƒˆ', 'æ¿€çƒˆ', 'ç‹ ç‹ ', 'æ¯«ä¸ç•™æƒ…', 'ä¸€é’ˆè§è¡€'
    ];

    const intensityLevels = [
      'æº«å’Œç†æ€§åœ°',
      'ç¨å¾®åš´è‚…åœ°',
      'ç›´æ¥åœ°',
      'åš´å²åœ°',
      'çŠ€åˆ©åœ°',
      'å¼·çƒˆåœ°',
      'æ¿€çƒˆåœ°',
      'ç‹ ç‹ åœ°',
      'æ¯«ä¸ç•™æƒ…åœ°',
      'ä¸€é‡è¦‹è¡€åœ°'
    ];

    // å…ƒç´ å¼•ç”¨
    const opponentTextEl = document.getElementById('opponentText');
    const charCountEl = document.getElementById('charCount');
    const intensitySliderEl = document.getElementById('intensitySlider');
    const intensityValueEl = document.getElementById('intensityValue');
    const intensityLabelEl = document.getElementById('intensityLabel');
    const submitBtnEl = document.getElementById('submitBtn');
    const clearBtnEl = document.getElementById('clearBtn');
    const errorMessageEl = document.getElementById('errorMessage');
    const responseAreaEl = document.getElementById('responseArea');
    const loadingAreaEl = document.getElementById('loadingArea');
    const responsesContainerEl = document.getElementById('responsesContainer');
    const responsesListEl = document.getElementById('responsesList');
    const copyAllBtnEl = document.getElementById('copyAllBtn');

    let currentResponses = [];

    // åˆå§‹åŒ–
    function init() {
      updateCharCount();
      updateIntensityDisplay();
      
      // äº‹ä»¶ç›£è½å™¨
      opponentTextEl.addEventListener('input', updateCharCount);
      intensitySliderEl.addEventListener('input', updateIntensityDisplay);
      submitBtnEl.addEventListener('click', handleSubmit);
      clearBtnEl.addEventListener('click', clearForm);
      copyAllBtnEl.addEventListener('click', copyAllResponses);
      
      // æ›´æ–°æ»‘å‹•æ¢èƒŒæ™¯
      updateSliderBackground();
      intensitySliderEl.addEventListener('input', updateSliderBackground);
    }

    function updateCharCount() {
      const count = opponentTextEl.value.length;
      charCountEl.textContent = count;
    }

    function updateIntensityDisplay() {
      const value = parseInt(intensitySliderEl.value);
      intensityValueEl.textContent = `${value}/10`;
      intensityLabelEl.textContent = intensityLabels[value - 1];
    }

    function updateSliderBackground() {
      const value = parseInt(intensitySliderEl.value);
      const percentage = (value - 1) * 11.11;
      intensitySliderEl.style.background = `linear-gradient(to right, #07C160 0%, #07C160 ${percentage}%, #e5e5e5 ${percentage}%, #e5e5e5 100%)`;
    }

    function showError(message) {
      errorMessageEl.textContent = message;
      errorMessageEl.classList.remove('hidden');
    }

    function hideError() {
      errorMessageEl.classList.add('hidden');
    }

    function showLoading() {
      responseAreaEl.classList.remove('hidden');
      loadingAreaEl.classList.remove('hidden');
      responsesContainerEl.classList.add('hidden');
    }

    function hideLoading() {
      loadingAreaEl.classList.add('hidden');
      responsesContainerEl.classList.remove('hidden');
    }

    async function generateQuarrelResponses(opponentText, intensity) {
      const response = await fetch('/.netlify/functions/deepseek', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          opponentText,
          intensity,
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `API è«‹æ±‚å¤±æ•—: ${response.statusText}`);
      }

      const data = await response.json();
      return data.responses;
    }

    async function handleSubmit() {
      const opponentText = opponentTextEl.value.trim();
      const intensity = parseInt(intensitySliderEl.value);

      if (!opponentText) {
        showError('è¯·è¾“å…¥å¯¹æ–¹è¯´çš„è¯');
        return;
      }

      hideError();
      showLoading();
      submitBtnEl.disabled = true;
      submitBtnEl.textContent = 'ç”Ÿæˆä¸­...';

      try {
        const responses = await generateQuarrelResponses(opponentText, intensity);
        currentResponses = responses;
        displayResponses(responses);
        hideLoading();
        
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
        saveToHistory(opponentText, intensity, responses);
      } catch (error) {
        console.error('ç”Ÿæˆå›æ‡‰å¤±æ•—:', error);
        showError('æ— æ³•ç”Ÿæˆå›åº”ï¼Œè¯·ç¨åå†è¯•');
        responseAreaEl.classList.add('hidden');
      } finally {
        submitBtnEl.disabled = false;
                  submitBtnEl.textContent = 'ğŸ”¥ å¼€å§‹åµæ¶';
      }
    }

    function displayResponses(responses) {
      responsesListEl.innerHTML = '';
      
      responses.forEach((response, index) => {
        const responseEl = document.createElement('div');
        responseEl.className = 'bg-white rounded-lg p-4 shadow-md border-l-4 border-wechat-primary mb-4';
        responseEl.innerHTML = `
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center mb-2">
                <span class="bg-wechat-primary text-white text-xs px-2 py-1 rounded-full font-bold">
                  ç¬¬ ${index + 1} æ“Š
                </span>
              </div>
              <p class="text-gray-800 leading-relaxed">
                ${response}
              </p>
            </div>
            <button
              onclick="copyToClipboard('${response.replace(/'/g, "\\'")}')"
              class="ml-3 p-2 text-gray-400 hover:text-wechat-primary transition-colors"
              title="å¤åˆ¶æ–‡å­—"
            >
              ğŸ“‹
            </button>
          </div>
        `;
        responsesListEl.appendChild(responseEl);
      });
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // å¯ä»¥æ·»åŠ æç¤ºï¼Œé€™è£¡ç°¡åŒ–è™•ç†
        console.log('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      }).catch(err => {
        console.error('å¤åˆ¶å¤±è´¥:', err);
      });
    }

    function copyAllResponses() {
      const allText = currentResponses.join('\n\n');
      copyToClipboard(allText);
    }

    function clearForm() {
      opponentTextEl.value = '';
      intensitySliderEl.value = '5';
      updateCharCount();
      updateIntensityDisplay();
      updateSliderBackground();
      hideError();
      responseAreaEl.classList.add('hidden');
      currentResponses = [];
    }

    function saveToHistory(opponentText, intensity, responses) {
      try {
        const history = JSON.parse(localStorage.getItem('quarrel-history') || '[]');
        const newItem = {
          id: Date.now().toString(),
          opponentText,
          intensity,
          responses,
          timestamp: Date.now()
        };
        
        const updatedHistory = [newItem, ...history].slice(0, 50);
        localStorage.setItem('quarrel-history', JSON.stringify(updatedHistory));
      } catch (error) {
        console.error('ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
      }
    }

    // åˆå§‹åŒ–æ‡‰ç”¨
    init();
  </script>
</body>
</html> 